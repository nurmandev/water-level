<!DOCTYPE html>
<html>
  <head>
    <%- include('partials/head'); %>
  </head>
  <body>
    <%- include('navbar', { user: user }); %>

    <main>
      <div class="container">
        <h1>Hello, <%= user.username %></h1>
      </div>

      <div id="services" class="services section">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 offset-lg-2">
              <div
                class="section-heading wow fadeInDown"
                data-wow-duration="1s"
                data-wow-delay="0.5s"
              >
                <h2>
                  Welcome to your Dashboard, <em><%= user.username %>!</em>
                </h2>
                <img src="assets/images/heading-line-dec.png" alt="" />
                <p>This is your dashboard where you can manage your account.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="card-deck">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Tank</h5>
              <div class="progress progress-bar-vertical">
                <div
                  class="progress-bar progress-bar-danger bg-info progress-bar-striped progress-bar-animated"
                  role="progressbar"
                  aria-valuenow="0"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  id="tankProgress"
                  style="height: 0%"
                >
                  <div class="container">
                    <span class="sr-only" id="tankPercentage">0%</span>
                  </div>
                </div>
              </div>
              <div class="container">
                <p id="distance">Tank is filled up for: 0%</p>
              </div>
              <div class="card-footer container">
                <small class="text-muted" id="status"
                  >Status: Monitoring...</small
                >
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">History</h5>
              <canvas id="historyChart"></canvas>
            </div>
            <div class="card-footer">
              <small class="text-muted">Last updated # mins ago</small>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div class="container">
      <h1><%= user.username %> This is your details</h1>
      <table class="table table-bordered">
        <tr>
          <th>Username</th>
          <td><%= user.username %></td>
        </tr>
        <tr>
          <th>Email</th>
          <td><%= user.email %></td>
        </tr>
        <tr>
          <th>Age</th>
          <td><%= user.age %></td>
        </tr>
        <tr>
          <th>Height</th>
          <td><%= user.height %></td>
        </tr>
        <tr>
          <th>Weight</th>
          <td><%= user.weight %></td>
        </tr>
      </table>
      <div id="sensor-data"></div>

      <script>
        fetch("/sensor-data")
          .then((response) => response.json())
          .then((data) => {
            const sensorDataDiv = document.getElementById("sensor-data");
            sensorDataDiv.innerHTML = `Latest Sensor Data: ${JSON.stringify(
              data
            )}`;
          });
      </script>
    </div>

    <div class="container">
      <h2>Latest Sensor Data</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Sensor</th>
            <th>Distance (cm)</th>
          </tr>
        </thead>
        <tbody id="sensor-data-body">
          <tr>
            <td id="sensor-type">-</td>
            <td id="sensor-distance">-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      function fetchSensorData() {
        fetch("/sensor-data")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("sensor-type").innerText =
              data.sensor || "-";
            document.getElementById("sensor-distance").innerText =
              data.distance !== undefined ? data.distance + " cm" : "-";
          })
          .catch((error) =>
            console.error("Error fetching sensor data:", error)
          );
      }

      setInterval(fetchSensorData, 5000); // Fetch data every 5 seconds
      fetchSensorData(); // Initial fetch
    </script>
    <%- include('partials/footer'); %>
  </body>
</html>
